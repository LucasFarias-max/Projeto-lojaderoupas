<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finalizar Compra - Ponto Fino</title>
    <link rel="stylesheet" href="checkout.css">
    <link rel="shortcut icon" href="logo.ico" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>

    <header class="cabecalho">
        <div class="logo">
            <div class="marca">
                <img src="android-chrome-512x512.png" alt="Logo">
            </div>
            <div class="nome"><h2>Ponto Fino</h2></div>
        </div>
        <div class="central">
            <form class="buscador" action="/buscar" method="get">
                <input type="text" name="q" placeholder="Buscar produto...">
                <button type="submit">Buscar</button>
            </form>
        </div>
        <div class="espaco-direita">
            <a href="cadastro.html"><button class="cadastrar">Cadastrar-se</button></a>
            <a href="carrinho.html"><img src="https://cdn-icons-png.flaticon.com/512/107/107831.png" alt="Carrinho"></a>
        </div>
    </header>
    <main class="checkout-page-content">
        <div class="header-checkout">
            <div class="user-info">
                <p>Olá, <span id="userName">Usuário</span>!</p>
            </div>
            <div class="navigation-links">
                <a href="home.html"><i class="fas fa-home"></i> Home</a>
                <a href="carrinho.html"><i class="fas fa-shopping-cart"></i> Voltar ao Carrinho</a>
            </div>
        </div>

        <h1>Finalizar Compra</h1>

        <div class="checkout-layout">
            <div class="checkout-form-sections">
                <section class="checkout-section">
                    <h2><i class="fas fa-map-marker-alt"></i> Endereço de Entrega</h2>
                    <form id="shipping-form">
                        <div class="form-group">
                            <label for="nome">Nome Completo:</label>
                            <input type="text" id="nome" name="nome" required>
                        </div>
                        <div class="form-group">
                            <label for="cep">CEP:</label>
                            <input type="text" id="cep" name="cep" required placeholder="Ex: 00000-000" onkeyup="formatCEP(this)">
                        </div>
                        <div class="form-group">
                            <label for="endereco">Endereço:</label>
                            <input type="text" id="endereco" name="endereco" required placeholder="Rua, Avenida, etc.">
                        </div>
                        <div class="form-group half-width">
                            <label for="numero">Número:</label>
                            <input type="text" id="numero" name="numero" required>
                        </div>
                        <div class="form-group half-width">
                            <label for="complemento">Complemento (Opcional):</label>
                            <input type="text" id="complemento" name="complemento">
                        </div>
                        <div class="form-group half-width">
                            <label for="bairro">Bairro:</label>
                            <input type="text" id="bairro" name="bairro" required>
                        </div>
                        <div class="form-group half-width">
                            <label for="cidade">Cidade:</label>
                            <input type="text" id="cidade" name="cidade" required>
                        </div>
                        <div class="form-group half-width">
                            <label for="estado">Estado:</label>
                            <select id="estado" name="estado" required>
                                <option value="">Selecione...</option>
                                <option value="AC">Acre</option>
                                <option value="AL">Alagoas</option>
                                <option value="AP">Amapá</option>
                                <option value="AM">Amazonas</option>
                                <option value="BA">Bahia</option>
                                <option value="CE">Ceará</option>
                                <option value="DF">Distrito Federal</option>
                                <option value="ES">Espírito Santo</option>
                                <option value="GO">Goiás</option>
                                <option value="MA">Maranhão</option>
                                <option value="MT">Mato Grosso</option>
                                <option value="MS">Mato Grosso do Sul</option>
                                <option value="MG">Minas Gerais</option>
                                <option value="PA">Pará</option>
                                <option value="PB">Paraíba</option>
                                <option value="PR">Paraná</option>
                                <option value="PE">Pernambuco</option>
                                <option value="PI">Piauí</option>
                                <option value="RJ">Rio de Janeiro</option>
                                <option value="RN">Rio Grande do Norte</option>
                                <option value="RS">Rio Grande do Sul</option>
                                <option value="RO">Rondônia</option>
                                <option value="RR">Roraima</option>
                                <option value="SC">Santa Catarina</option>
                                <option value="SP">São Paulo</option>
                                <option value="SE">Sergipe</option>
                                <option value="TO">Tocantins</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="telefone">Telefone:</label>
                            <input type="tel" id="telefone" name="telefone" required placeholder="(XX) XXXXX-XXXX" onkeyup="formatPhone(this)">
                        </div>
                    </form>
                </section>

                <section class="checkout-section">
                    <h2><i class="fas fa-credit-card"></i> Método de Pagamento</h2>
                    <div class="payment-options">
                        <label class="payment-option">
                            <input type="radio" name="paymentMethod" value="creditCard" checked>
                            <img src="https://img.icons8.com/color/48/000000/visa.png" alt="Visa">
                            <img src="https://img.icons8.com/color/48/000000/mastercard.png" alt="Mastercard">
                            Cartão de Crédito
                        </label>
                        <label class="payment-option">
                            <input type="radio" name="paymentMethod" value="boleto">
                            <img src="https://img.icons8.com/fluency/48/000000/barcode.png" alt="Boleto">
                            Boleto Bancário
                        </label>
                        <label class="payment-option">
                            <input type="radio" name="paymentMethod" value="pix">
                            <img src="https://img.icons8.com/color/48/000000/pix.png" alt="Pix">
                            Pix
                        </label>
                    </div>

                    <div id="creditCardDetails" class="payment-details">
                        <div class="form-group">
                            <label for="cardNumber">Número do Cartão:</label>
                            <input type="text" id="cardNumber" name="cardNumber" placeholder="XXXX XXXX XXXX XXXX" required onkeyup="formatCardNumber(this)">
                        </div>
                        <div class="form-group">
                            <label for="cardName">Nome no Cartão:</label>
                            <input type="text" id="cardName" name="cardName" placeholder="Como no cartão" required>
                        </div>
                        <div class="form-group half-width">
                            <label for="expiryDate">Validade:</label>
                            <input type="text" id="expiryDate" name="expiryDate" placeholder="MM/AA" required onkeyup="formatExpiryDate(this)">
                        </div>
                        <div class="form-group half-width">
                            <label for="cvv">CVV:</label>
                            <input type="text" id="cvv" name="cvv" placeholder="XXX" required onkeyup="formatCVV(this)">
                        </div>
                        <div class="form-group">
                            <label for="installments">Parcelas:</label>
                            <select id="installments" name="installments">
                                <option value="1">1x sem juros</option>
                                <option value="2">2x sem juros</option>
                                <option value="3">3x sem juros</option>
                                <option value="4">4x com juros</option>
                            </select>
                        </div>
                    </div>
                    </section>
            </div>

            <div class="order-summary">
                <h2><i class="fas fa-file-invoice-dollar"></i> Resumo do Pedido</h2>
                <div id="order-items-summary">
                    <p class="empty-order-summary-message">Nenhum item no pedido.</p>
                </div>
                <div class="summary-line">
                    <span>Subtotal:</span>
                    <span id="summary-subtotal">R$ 0,00</span>
                </div>
                <div class="summary-line">
                    <span>Frete:</span>
                    <span id="summary-frete">R$ 0,00</span>
                </div>
                <div class="summary-line total">
                    <span>Total:</span>
                    <span id="summary-total">R$ 0,00</span>
                </div>
                <button class="btn-primary-large" onclick="processarCompra()">Finalizar Compra</button>
                <a href="carrinho.html" class="btn-back-to-cart"><i class="fas fa-arrow-left"></i> Voltar ao Carrinho</a>
            </div>
        </div>
    </main>

    <footer>
        <div class="social-icons">
            <a href="https://facebook.com" target="_blank" aria-label="Facebook"><i class="fab fa-facebook"></i></a>
            <a href="https://instagram.com" target="_blank" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
            <a href="https://twitter.com" target="_blank" aria-label="Twitter"><i class="fab fa-x-twitter"></i></a>
        </div>
        <p>Copyright © 2025 Ponto Fino. Todos os direitos reservados.</p>
        <p>Contato: pontofino@gmail.com</p>
    </footer>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            loadUserName();
            carregarResumoPedido();
            setupPaymentMethodToggle();
        });

        function loadUserName() {
            const userNameSpan = document.getElementById("userName");
            userNameSpan.textContent = "João Silva"; // Exemplo
        }

        function calcularFrete(subtotal) {
            if (subtotal === 0) return 0;
            return 15.00; // Frete fixo de R$15,00
        }

        function carregarResumoPedido() {
            const orderItemsContainer = document.getElementById("order-items-summary");
            const summarySubtotalSpan = document.getElementById("summary-subtotal");
            const summaryFreteSpan = document.getElementById("summary-frete");
            const summaryTotalSpan = document.getElementById("summary-total");
            const emptyOrderMessage = document.querySelector('.empty-order-summary-message');

            let carrinho = JSON.parse(localStorage.getItem("carrinho")) || [];
            let subtotal = 0;

            orderItemsContainer.innerHTML = ''; // Limpa conteúdo anterior

            if (carrinho.length === 0) {
                emptyOrderMessage.style.display = 'block';
                orderItemsContainer.appendChild(emptyOrderMessage);
            } else {
                emptyOrderMessage.style.display = 'none';
                carrinho.forEach(item => {
                    const itemElement = document.createElement("div");
                    itemElement.classList.add("summary-item");
                    itemElement.innerHTML = `
                        <span>${item.title} (x${item.quantidade || 1})</span>
                        <span>R$ ${(item.price * (item.quantidade || 1)).toFixed(2)}</span>
                    `;
                    orderItemsContainer.appendChild(itemElement);
                    subtotal += item.price * (item.quantidade || 1);
                });
            }

            const frete = calcularFrete(subtotal);
            const total = subtotal + frete;

            summarySubtotalSpan.textContent = `R$ ${subtotal.toFixed(2)}`;
            summaryFreteSpan.textContent = `R$ ${frete.toFixed(2)}`;
            summaryTotalSpan.textContent = `R$ ${total.toFixed(2)}`;

            // Desabilita o botão de finalizar compra se o carrinho estiver vazio
            const btnFinalizar = document.querySelector('.btn-primary-large');
            if (carrinho.length === 0) {
                btnFinalizar.disabled = true;
                btnFinalizar.classList.add('disabled');
            } else {
                btnFinalizar.disabled = false;
                btnFinalizar.classList.remove('disabled');
            }
        }

        function processarCompra() {
            const carrinho = JSON.parse(localStorage.getItem("carrinho")) || [];
            if (carrinho.length === 0) {
                alert("Seu carrinho está vazio. Não é possível finalizar a compra.");
                return;
            }

            // Validação simples do formulário (você pode expandir isso)
            const shippingForm = document.getElementById('shipping-form');
            if (!shippingForm.checkValidity()) {
                alert("Por favor, preencha todos os campos obrigatórios de endereço.");
                shippingForm.reportValidity(); // Mostra as mensagens de erro do navegador
                return;
            }

            const paymentMethod = document.querySelector('input[name="paymentMethod"]:checked').value;
            if (paymentMethod === 'creditCard') {
                const cardNumber = document.getElementById('cardNumber').value;
                const cardName = document.getElementById('cardName').value;
                const expiryDate = document.getElementById('expiryDate').value;
                const cvv = document.getElementById('cvv').value;

                if (!cardNumber || !cardName || !expiryDate || !cvv) {
                    alert("Por favor, preencha todos os dados do cartão de crédito.");
                    return;
                }
                // Adicione validações de formato de cartão mais robustas aqui
            }

            alert("Compra finalizada com sucesso! (Funcionalidade de processamento de pagamento a ser implementada)");
            // Em um cenário real, você enviaria os dados do pedido e pagamento para o backend.
            // Após a finalização, limparia o carrinho e redirecionaria para uma página de confirmação.
            localStorage.removeItem("carrinho"); // Limpa o carrinho após a "compra"
            window.location.href = "confirmacao_compra.html"; // Redireciona para uma página de confirmação
        }

        function setupPaymentMethodToggle() {
            const paymentMethods = document.querySelectorAll('input[name="paymentMethod"]');
            const creditCardDetails = document.getElementById('creditCardDetails');

            paymentMethods.forEach(radio => {
                radio.addEventListener('change', () => {
                    if (radio.value === 'creditCard') {
                        creditCardDetails.style.display = 'block';
                        // Adicionar 'required' aos campos do cartão quando selecionado
                        creditCardDetails.querySelectorAll('input').forEach(input => input.setAttribute('required', 'true'));
                    } else {
                        creditCardDetails.style.display = 'none';
                        // Remover 'required' quando não selecionado para evitar validações indesejadas
                        creditCardDetails.querySelectorAll('input').forEach(input => input.removeAttribute('required'));
                    }
                });
            });

            // Garante que o estado inicial esteja correto (se Cartão for o padrão)
            if (document.querySelector('input[name="paymentMethod"][value="creditCard"]').checked) {
                 creditCardDetails.style.display = 'block';
                 creditCardDetails.querySelectorAll('input').forEach(input => input.setAttribute('required', 'true'));
            } else {
                creditCardDetails.style.display = 'none';
                creditCardDetails.querySelectorAll('input').forEach(input => input.removeAttribute('required'));
            }
        }


        // Funções de formatação de input (opcional, mas melhora a UX)
        function formatCEP(input) {
            let value = input.value.replace(/\D/g, ''); // Remove tudo que não é dígito
            if (value.length > 5) {
                value = value.substring(0, 5) + '-' + value.substring(5, 8);
            }
            input.value = value;
        }

        function formatPhone(input) {
            let value = input.value.replace(/\D/g, ''); // Remove tudo que não é dígito
            if (value.length > 10) {
                value = `(${value.substring(0, 2)}) ${value.substring(2, 7)}-${value.substring(7, 11)}`;
            } else if (value.length > 6) {
                value = `(${value.substring(0, 2)}) ${value.substring(2, 6)}-${value.substring(6, 10)}`;
            } else if (value.length > 2) {
                value = `(${value.substring(0, 2)}) ${value.substring(2)}`;
            }
            input.value = value;
        }

        function formatCardNumber(input) {
            let value = input.value.replace(/\D/g, ''); // Remove tudo que não é dígito
            value = value.replace(/(\d{4})(?=\d)/g, '$1 '); // Adiciona espaço a cada 4 dígitos
            input.value = value.trim();
        }

        function formatExpiryDate(input) {
            let value = input.value.replace(/\D/g, '');
            if (value.length > 2) {
                value = value.substring(0, 2) + '/' + value.substring(2, 4);
            }
            input.value = value;
        }

        function formatCVV(input) {
            let value = input.value.replace(/\D/g, '');
            input.value = value.substring(0, 4); // CVV pode ter 3 ou 4 dígitos
        }
    </script>
</body>
</html>